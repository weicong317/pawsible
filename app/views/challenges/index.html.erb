<!-- SPONSOR IMAGE -->

<div class="text-center">
 <img src="http://via.placeholder.com/1500x250" class="img-fluid max-width: 100%;" alt="sponsorimage">
</div></br></br>

<!-- text Area -->

<div class="text-center">
 <h2>This Weekâ€™s Challenges</h1>
</div></br>

<!-- CARDS / 3 PER ROW / HEAVE LEFT THE IMAGE IN CASE WANTED TO ADD? -->
<% completed = false %>
<% if signed_in? %>
  <% @challenges.each do |challenge| %>
    <% if current_user.completeAllChallenge?(challenge.id) %>
      <% completed = true %>
    <% else %>
      <% completed = false %>
      <% break %>
    <% end %>
  <% end %>  
<% end %>

<div class="container">
  <% if completed === true %>
    <div class="col-sm-4 offset-4 border card border-primary mb-3 bg-white">
      <div class="card">
        <div class="card-block">
          <h4 class="card-title">You have finished all the challenges this week!</h4>
          <hr>
          <p class="card-subtitle mb-2">Come next week again!</p>  
        </div>
      </div>
    </div>
    <div class="row" style="opacity: 0.5;">
  <% else %>
   <div class="row">
  <% end %>    
      <% @challenges.each do |challenge| %>
      <!-- Here we need another if statement, that either removes, or changes how the challenge looks if it has already been completed?  -->
         <div class="col-sm-4 mb-3">
           <div class="card border border-primary py-2 px-4">
               <div class="card-block">
                 <h4 class="card-title"><%= challenge.title %></h4>  
                 <p class="card-subtitle mb-2"><%= challenge.description %></p>
                 <hr>
                 <p class="card-subtitle mb-2 text-muted text-right"><%= "#{challenge.points} points" %></p>
                  <% if signed_in? %>
                    <% if current_user.completeChallenge?(challenge.id) %>
                      <button type="button" class="mb-4 btn btn-primary" id="complete_button" data-toggle="modal" data-target="#challenge-<%= challenge.id %>" disabled>
                          Completed Challenge
                        </button>
                    <% else %>
                      <button type="button" class="mb-4 btn btn-primary" id="complete_button" data-toggle="modal" data-target="#challenge-<%= challenge.id %>">
                        Complete Challenge
                      </button>
                    <% end %>
                    <div class="modal fade" id="challenge-<%= challenge.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Complete Challenge, <%= challenge.title %></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">

                    <!-- This is the content of the modal, to complete challenge -->

                        <%= form_with scope: :upload, url: challenge_uploads_path(challenge.id), local: true do |f| %>
                          <%= f.label :media, "Upload video or image"%>
                          <br>
                          <%= f.file_field :media %>

                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <%= f.submit "Upload", class: "btn btn-primary" %>
                          </div>
                          <% end %>

                          </div>
                        </div>
                      </div>
                    </div>
                  <% else %>
                    <%= button_to "Sign in to post!", sign_in_path, method: :get, class: "mb-4 btn btn-primary" %>
                 <% end %>
                       
               </div>
          </div>
        </div>
    <% end %>
  </div>
</div>

</br></br>